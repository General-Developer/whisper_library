#!/bin/bash

echo "Compile"
BASE_COMPILE_DIRECTORY="build"
BASE_WHISPER_CPP_COMPILE_DIRECTORY="$BASE_COMPILE_DIRECTORY/whisper.cpp"
BASE_PREBUILT_DIRECTORY="prebuilt/lib"
cmake -B $BASE_COMPILE_DIRECTORY -DCMAKE_BUILD_TYPE=Release
cmake --build $BASE_COMPILE_DIRECTORY --config Release -j $(nproc)
rm -rf $BASE_PREBUILT_DIRECTORY
mkdir -p $BASE_PREBUILT_DIRECTORY
cp -rf $BASE_WHISPER_CPP_COMPILE_DIRECTORY/src/lib*.so $BASE_PREBUILT_DIRECTORY
cp -rf $BASE_WHISPER_CPP_COMPILE_DIRECTORY/src/lib*.so.* $BASE_PREBUILT_DIRECTORY
cp -rf $BASE_WHISPER_CPP_COMPILE_DIRECTORY/ggml/src/lib*.so $BASE_PREBUILT_DIRECTORY
rm -rf $BASE_COMPILE_DIRECTORY

 